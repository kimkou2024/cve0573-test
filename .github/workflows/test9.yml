name: redirect-leak-test
on: workflow_dispatch
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Test auth header on redirects
        env:
          GH_TOK: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "=== Archive with -L (follow redirect) ==="
          curl -sv -L -H "Authorization: token $GH_TOK" "https://github.com/kimkou2024/cve0573-test/archive/HEAD.tar.gz" 2>&1 | grep -iE "> authorization:|< HTTP|< location:" || true
          echo "=== API release asset redirect ==="
          curl -sv -L -H "Authorization: token $GH_TOK" -H "Accept: application/octet-stream" "https://api.github.com/repos/cli/cli/releases/assets/358046922" 2>&1 | grep -iE "> authorization:|< HTTP|< location:" | head -20 || true
